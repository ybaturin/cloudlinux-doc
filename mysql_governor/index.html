<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL Governor | Documentation</title>
    <meta name="description" content="CloudLinux Documentation">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.499e4a83.css" as="style"><link rel="preload" href="/assets/js/app.c9f6c3cd.js" as="script"><link rel="preload" href="/assets/js/29.85d24611.js" as="script"><link rel="prefetch" href="/assets/js/10.225f7b4a.js"><link rel="prefetch" href="/assets/js/11.d19c5be5.js"><link rel="prefetch" href="/assets/js/12.e010b4a7.js"><link rel="prefetch" href="/assets/js/13.81e56b5b.js"><link rel="prefetch" href="/assets/js/14.e97e18bd.js"><link rel="prefetch" href="/assets/js/15.ded13bdb.js"><link rel="prefetch" href="/assets/js/16.a951b540.js"><link rel="prefetch" href="/assets/js/17.5ae8541f.js"><link rel="prefetch" href="/assets/js/18.2d3ad9f4.js"><link rel="prefetch" href="/assets/js/19.7432c60e.js"><link rel="prefetch" href="/assets/js/20.8d658fb8.js"><link rel="prefetch" href="/assets/js/21.792e504a.js"><link rel="prefetch" href="/assets/js/22.ff1d91e2.js"><link rel="prefetch" href="/assets/js/23.24f2993e.js"><link rel="prefetch" href="/assets/js/24.fc76986c.js"><link rel="prefetch" href="/assets/js/25.c8b2b101.js"><link rel="prefetch" href="/assets/js/26.c5354b0c.js"><link rel="prefetch" href="/assets/js/27.54515300.js"><link rel="prefetch" href="/assets/js/28.fae420cd.js"><link rel="prefetch" href="/assets/js/3.9f4cfcb2.js"><link rel="prefetch" href="/assets/js/30.7ea39c0a.js"><link rel="prefetch" href="/assets/js/31.2791e1bb.js"><link rel="prefetch" href="/assets/js/32.061666aa.js"><link rel="prefetch" href="/assets/js/33.87ee32f3.js"><link rel="prefetch" href="/assets/js/34.21f12f91.js"><link rel="prefetch" href="/assets/js/35.323fa534.js"><link rel="prefetch" href="/assets/js/36.17ec244b.js"><link rel="prefetch" href="/assets/js/37.920549b1.js"><link rel="prefetch" href="/assets/js/38.2d4d0533.js"><link rel="prefetch" href="/assets/js/39.357a96c9.js"><link rel="prefetch" href="/assets/js/4.cfe66a99.js"><link rel="prefetch" href="/assets/js/40.1ce5bb28.js"><link rel="prefetch" href="/assets/js/41.07114dc6.js"><link rel="prefetch" href="/assets/js/42.9b007a0b.js"><link rel="prefetch" href="/assets/js/43.706bd226.js"><link rel="prefetch" href="/assets/js/44.7e6e3e39.js"><link rel="prefetch" href="/assets/js/45.bb49e15a.js"><link rel="prefetch" href="/assets/js/46.a76db938.js"><link rel="prefetch" href="/assets/js/47.03883f5a.js"><link rel="prefetch" href="/assets/js/48.4a33aa97.js"><link rel="prefetch" href="/assets/js/49.f7fab87c.js"><link rel="prefetch" href="/assets/js/5.6388205e.js"><link rel="prefetch" href="/assets/js/50.8eb4c8b3.js"><link rel="prefetch" href="/assets/js/51.58699738.js"><link rel="prefetch" href="/assets/js/52.9c14419e.js"><link rel="prefetch" href="/assets/js/53.a869cd79.js"><link rel="prefetch" href="/assets/js/54.56bb4414.js"><link rel="prefetch" href="/assets/js/55.9f56a8b6.js"><link rel="prefetch" href="/assets/js/56.71cc99ea.js"><link rel="prefetch" href="/assets/js/57.2144cf8b.js"><link rel="prefetch" href="/assets/js/58.90fbdc5e.js"><link rel="prefetch" href="/assets/js/59.95db2a8f.js"><link rel="prefetch" href="/assets/js/6.ef57d446.js"><link rel="prefetch" href="/assets/js/60.7e5049a6.js"><link rel="prefetch" href="/assets/js/61.f66b37ab.js"><link rel="prefetch" href="/assets/js/62.588263b8.js"><link rel="prefetch" href="/assets/js/63.18725a6f.js"><link rel="prefetch" href="/assets/js/64.968fbd33.js"><link rel="prefetch" href="/assets/js/65.809665f8.js"><link rel="prefetch" href="/assets/js/7.ec64087b.js"><link rel="prefetch" href="/assets/js/8.2fb2d055.js"><link rel="prefetch" href="/assets/js/9.94126e20.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.45919bba.js">
    <link rel="stylesheet" href="/assets/css/0.styles.499e4a83.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><section class="navbar"><header class="navbar__header"><section class="navbar__block"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="Documentation" class="logo"> <img src="/logo-short.svg" alt="Documentation" class="logo-short"></a> <div class="site-name">
        Documentation
      </div> <form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" placeholder="Search" class="search-query"></form></section> <section class="navbar__block"><button class="menu-btn">
        Products
      </button> <button class="navbar-btn navbar-btn--submit-request">Submit request</button> <div class="links" style="max-width:nullpx;"><a href="https://cloudlinux.com/trial" target="_blank" class="navbar-btn navbar-btn--try-free">Try Free</a> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><span class="title">Language:</span> <a class="dropdown-title"><span class="text">En</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mysql_governor/" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/ru/mysql_governor/" class="nav-link">Русский</a></li></ul></div></div></nav></div></section></header> <!----></section> <div class="sidebar-mask"></div> <div class="sidebar"> <ul class="sidebar-links"><li><div class="sidebar-group first"><div class="sidebar-heading open"><span>Content</span> <!----></div> <ul class="sidebar-group-items"><li><a href="/cloudlinux_installation/" class="sidebar-link">Installation</a></li><li><a href="/limits/" class="sidebar-link">Limits</a></li><li><a href="/command-line_tools/" class="sidebar-link">Command-line Tools</a></li><li><a href="/lve_manager/" class="sidebar-link">LVE Manager</a></li><li><a href="/reseller_limits/" class="sidebar-link">Reseller Limits</a></li><li><a href="/lve-stats_2/" class="sidebar-link">LVE-Stats 2</a></li><li><a href="/cagefs/" class="sidebar-link">CageFS</a></li><li><a href="/mysql_governor/" class="active sidebar-link">MySQL Governor</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mysql_governor/#installation" class="sidebar-link">Installation</a></li><li class="sidebar-sub-header"><a href="/mysql_governor/#upgrading-database-server" class="sidebar-link">Upgrading database server</a></li><li class="sidebar-sub-header"><a href="/mysql_governor/#removing-mysql-governor" class="sidebar-link">Removing MySQL Governor</a></li><li class="sidebar-sub-header"><a href="/mysql_governor/#modes-of-operation" class="sidebar-link">Modes Of Operation</a></li><li class="sidebar-sub-header"><a href="/mysql_governor/#configuration" class="sidebar-link">Configuration</a></li><li class="sidebar-sub-header"><a href="/mysql_governor/#starting-and-stopping" class="sidebar-link">Starting And Stopping</a></li><li class="sidebar-sub-header"><a href="/mysql_governor/#mapping-a-user-to-database" class="sidebar-link">Mapping a User to Database</a></li><li class="sidebar-sub-header"><a href="/mysql_governor/#log-files" class="sidebar-link">Log Files</a></li><li class="sidebar-sub-header"><a href="/mysql_governor/#change-mysql-version" class="sidebar-link">Change MySQL version</a></li><li class="sidebar-sub-header"><a href="/mysql_governor/#command-line-tools" class="sidebar-link">Command-line Tools</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mysql_governor/#dbtop" class="sidebar-link">dbtop</a></li><li class="sidebar-sub-header"><a href="/mysql_governor/#dbctl" class="sidebar-link">dbctl</a></li><li class="sidebar-sub-header"><a href="/mysql_governor/#lveinfo-dbgov" class="sidebar-link">lveinfo --dbgov</a></li><li class="sidebar-sub-header"><a href="/mysql_governor/#dbgovchart" class="sidebar-link">dbgovchart</a></li></ul></li><li class="sidebar-sub-header"><a href="/mysql_governor/#backing-up-mysql" class="sidebar-link">Backing Up MySQL</a></li><li class="sidebar-sub-header"><a href="/mysql_governor/#abrt-plugin" class="sidebar-link">abrt plugin</a></li><li class="sidebar-sub-header"><a href="/mysql_governor/#troubleshooting" class="sidebar-link">Troubleshooting</a></li></ul></li><li><a href="/php_selector/" class="sidebar-link">PHP Selector</a></li><li><a href="/python_selector/" class="sidebar-link">Python Selector</a></li><li><a href="/ruby_selector/" class="sidebar-link">Ruby Selector</a></li><li><a href="/node_js_selector/" class="sidebar-link">Node.js Selector</a></li><li><a href="/inodes_limits/" class="sidebar-link">inodes</a></li><li><a href="/kernel_settings/" class="sidebar-link">Kernel Settings</a></li><li><a href="/apache_mod_lsapi/" class="sidebar-link">Apache mod_lsapi PRO</a></li><li><a href="/cloudlinux-fchange/" class="sidebar-link">File Change API</a></li><li><a href="/mod_proctitle/" class="sidebar-link">mod_proctitle</a></li><li><a href="/additional_packages/" class="sidebar-link">Additional Packages</a></li><li><a href="/integration_guide/" class="sidebar-link">Integration Guide</a></li><li><a href="/partner_portal/" class="sidebar-link">Partner Portal</a></li><li><a href="/cloudlinux_network/" class="sidebar-link">CloudLinux Network</a></li><li><a href="/cloudlinux_whmcs_plugin/" class="sidebar-link">CloudLinux WHMCS Plugin</a></li><li><a href="/deprecated/" class="sidebar-link">Deprecated</a></li><li><a href="/hardware_compatibility/" class="sidebar-link">Hardware Compatibility</a></li><li><a href="/cloudlinux_life-cycle/" class="sidebar-link">CloudLinux Life cycle</a></li></ul></div></li></ul> </div> <div class="page"> <div class="breadcrumb-wrapper page-breadcrumb" data-v-5e0e0acf><span class="breadcrumb-title" data-v-5e0e0acf>Documentation:</span> <a href="/mysql_governor/" class="breadcrumb router-link-exact-active router-link-active" data-v-5e0e0acf>
    MySQL Governor
  </a></div> <div class="page-nav-wrapper"><div class="page-nav"><a href="/cagefs/" class="nav-arrow left"></a> <a href="/php_selector/" class="nav-arrow right"></a></div></div> <div class="content content__default"><h1 id="mysql-governor"><a href="#mysql-governor" aria-hidden="true" class="header-anchor">#</a> MySQL Governor</h1> <p>[<span class="notranslate">MySQL Governor</span> 0.8-32+]</p> <p><span class="notranslate"> MySQL Governor </span> is software to monitor and restrict MySQL usage in shared hosting environment. The monitoring is done via resource usage statistics per each MySQL thread.</p> <p><span class="notranslate"> MySQL Governor </span> can also kill off slow <span class="notranslate"> SELECT </span> queries.</p> <p><span class="notranslate"> MySQL Governor </span> has multiple modes of operations, depending on the configuration. It can work in monitor-only mode, or it can use different throttling scenarious.</p> <p><span class="notranslate"> MySQL Governor </span> allows to restrict customers who use too much resources. It supports following limits:</p> <table><thead><tr><th></th> <th></th> <th></th></tr></thead> <tbody><tr><td><span class="notranslate"> CPU </span></td> <td>%</td> <td><span class="notranslate"> CPU </span> speed relative to one core. 150% would mean one and a half cores</td></tr> <tr><td><span class="notranslate"> READ </span></td> <td>bytes</td> <td>bytes read. Cached reads are not counted, only those that were actually read from disk will be counted</td></tr> <tr><td><span class="notranslate"> WRITE </span></td> <td>bytes</td> <td>bytes written. Cached writes are not counted, only once data is written to disk, it is counted</td></tr></tbody></table> <p>You can set different limits for different periods: current, short, med, long. By default those periods are defined as 1 second, 5 seconds, 1 minute and 5 minutes. They can be re-defined using <a href="/mysql_governor/#configuration">configuration file</a> . The idea is to use larger acceptable values for shorter periods. Like you could allow a customer to use two cores (200%) for one second, but only 1 core (on average) for 1 minute, and only 70% within 5 minutes. That would make sure that customer can burst for short periods of time.</p> <p>When customer is restricted, the customer will be placed into special LVE with ID 3. All restricted customers will be placed into that LVE, and you can control amount of resources available to restricted customers. Restricted customers will also be limited to only 30 concurrent connections. This is done so they wouldn't use up all the MySQL connections to the server.</p> <h2 id="installation"><a href="#installation" aria-hidden="true" class="header-anchor">#</a> Installation</h2> <p>::: danger IMPORTANT
Please make full database backup (including system tables) before you upgrade MySQL or switch to MariaDB. This action will prevent data losing in case if something goes wrong.
:::</p> <p><strong><em>MySQL Governor is compatible only with MySQL 5.x, 8.0; MariaDB &amp; Percona Server 5.6.</em></strong></p> <p>To install <span class="notranslate"> MySQL Governor </span> on your server install <span class="notranslate"> governor-mysql </span> package at first:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ yum remove db-governor db-governor-mysql  # you can ignore errors if you don't have those packages installed
$ yum install governor-mysql
</code></pre></div></div> <p>Then configure <span class="notranslate"> MySQL Governor </span> properly.</p> <p>The installation is currently supported only on <span class="notranslate"> cPanel, Plesk, DirectAdmin, ISPmanager, InterWorx </span> , as well as on servers without control panel.</p> <p>If you are installing <span class="notranslate"> CloudLinux </span> on a server running MySQL already, set your current MySQL version before calling installation script:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ /usr/share/lve/dbgovernor/mysqlgovernor.py --mysql-version=mysqlXX
$ /usr/share/lve/dbgovernor/mysqlgovernor.py --install
</code></pre></div></div> <p>Please make sure to specify your current MySQL version instead of XX as follows:</p> <ul><li>55 — MySQL v5.5</li> <li>56 — MySQL v5.6</li> <li>57 — MySQL v5.7</li> <li>80 — MySQL v8.0 [requires <span class="notranslate"> MySQL Governor </span> 1.2-37+; database packages are available in <span class="notranslate"> Beta </span> only, so, please use <span class="notranslate"><code>--install-beta</code></span> flag instead of <span class="notranslate"><code>--install</code></span> ]</li></ul> <p>If you are installing <span class="notranslate"> CloudLinux </span> on a server running <span class="notranslate"> MariaDB </span> already, do instead:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ /usr/share/lve/dbgovernor/mysqlgovernor.py --mysql-version=mariadbXX
$ /usr/share/lve/dbgovernor/mysqlgovernor.py --install
</code></pre></div></div> <p>Please make sure to specify your current <span class="notranslate"> MariaDB </span> version instead of <span class="notranslate"> XX </span> as follows:</p> <ul><li>55 — MariaDB v5.5</li> <li>100 — MariaDB v10.0</li> <li>101 — MariaDB v10.1</li> <li>102 — MariaDB v10.2</li> <li>103 — MariaDB v10.3 [requires <span class="notranslate"> MySQL Governor 1.2-36+; for cPanel - MySQL Governor 1.2-41+] </span></li></ul> <p>Installation for <span class="notranslate"> Percona Server 5.6 </span> [requires <span class="notranslate"> MySQL Governor </span> 1.1-22+ or 1.2-21+]:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ /usr/share/lve/dbgovernor/mysqlgovernor.py --mysql-version=percona56
$ /usr/share/lve/dbgovernor/mysqlgovernor.py --install
</code></pre></div></div> <p>Please note that <span class="notranslate"> MySQL/MariaDB/Percona </span> will be updated from <span class="notranslate"> CloudLinux </span> repositories.</p> <p>If you are installing <span class="notranslate"> MySQL Governor </span> on a server without MySQL at all, you have an opportunity to choose desired MySQL version to be installed with <span class="notranslate"> MySQL Governor </span> installation script. Use <span class="notranslate"> --mysql-version </span> flag before calling the installation script:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ /usr/share/lve/dbgovernor/mysqlgovernor.py --mysql-version=MYSQL_VERSION
$ /usr/share/lve/dbgovernor/mysqlgovernor.py --install
</code></pre></div></div> <p><span class="notranslate"> MYSQL_VERSION </span> could be chosen from the list of versions currently supported by <span class="notranslate"> MySQL Governor </span> :</p> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td>mysql51</td> <td>MySQL v5.1</td></tr> <tr><td>mysql55</td> <td>MySQL v5.5</td></tr> <tr><td>mysql56</td> <td>MySQL v5.6</td></tr> <tr><td>mysql57</td> <td>MySQL v5.7</td></tr> <tr><td>mysql80</td> <td>MySQL v8.0 [requires <span class="notranslate"> MySQL Governor </span> 1.2-37+; database packages available in beta only, so use <span class="notranslate"> --install-beta flag instead of --install] </span></td></tr> <tr><td>mariadb55</td> <td>MariaDB v5.5</td></tr> <tr><td>mariadb100</td> <td>MariaDB v10.0</td></tr> <tr><td>mariadb101</td> <td>MariaDB v10.1</td></tr> <tr><td>mariadb102</td> <td>MariaDB v 10.2</td></tr> <tr><td>mariadb103</td> <td>MariaDB v 10.3 [requires <span class="notranslate"> MySQL Governor 1.2-36+; for cPanel - MySQL Governor 1.2-41+] </span></td></tr> <tr><td>percona56</td> <td><span class="notranslate"> Percona Server v 5.6 </span></td></tr></tbody></table> <p>Generally, <span class="notranslate"> stable </span> and <span class="notranslate"> beta </span> channels contain different version of MySQL packages - <span class="notranslate"> beta </span> contains newer version than <span class="notranslate"> stable </span> or the same one. If you would like to install  <span class="notranslate"> beta </span>  packages, use  <span class="notranslate"> --install-beta </span>  flag instead of  <span class="notranslate"> --install </span>  when calling installation script:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ /usr/share/lve/dbgovernor/mysqlgovernor.py --install-beta
</code></pre></div></div> <p>Starting with <span class="notranslate"> MySQL Governor </span> version 1.2 when installing <span class="notranslate"> MySQL/MariaDB MySQL Governor </span> asks for a confirmation of a database version to be installed. To avoid such behavior for the automatic installations, please use <span class="notranslate"> --yes </span> flag.</p> <p>For example:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ /usr/share/lve/dbgovernor/mysqlgovernor.py --install --yes
</code></pre></div></div> <p>Please note that restore of previous packages in case of failed installation would also be confirmed with <span class="notranslate"> --yes </span> flag.</p> <p>::: danger IMPORTANT
Use <span class="notranslate"> --yes </span> flag on your own risk, because it confirms installation in any case - even in case if there are troubles during installation (for example, network problems causing incomplete download of packages), everything would be confirmed.
:::</p> <h2 id="upgrading-database-server"><a href="#upgrading-database-server" aria-hidden="true" class="header-anchor">#</a> Upgrading database server</h2> <p>In order to change MySQL version you should run the following commands:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ /usr/share/lve/dbgovernor/mysqlgovernor.py --mysql-version=MYSQL_VERSION
$ /usr/share/lve/dbgovernor/mysqlgovernor.py --install
</code></pre></div></div> <p>where <code>MYSQL_VERSION</code> is the target database server version that should be replaced with the value from the table above.</p> <p>::: danger IMPORTANT
Make sure you have full database backup (including system tables) before you switch. This action will prevent data loss in case if something goes wrong.
:::</p> <h2 id="removing-mysql-governor"><a href="#removing-mysql-governor" aria-hidden="true" class="header-anchor">#</a> Removing MySQL Governor</h2> <p>To remove <span class="notranslate"> MySQL Governor </span> :</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ /usr/share/lve/dbgovernor/mysqlgovernor.py --delete
</code></pre></div></div> <p>The script will install original MySQL server, and remove <span class="notranslate"> MySQL Governor </span> .</p> <h2 id="modes-of-operation"><a href="#modes-of-operation" aria-hidden="true" class="header-anchor">#</a> Modes Of Operation</h2> <p><strong>[</strong> <span class="notranslate"><strong>MySQL Governor</strong></span> <strong>1.0+]</strong></p> <p><span class="notranslate"> MySQL Governor </span> has multiple modes of operation. Some of them are experimental at this moment.<br>
Mode:<br> <span class="notranslate"><strong>off -- Monitor Only</strong> :  </span> In this mode <span class="notranslate"> MySQL Governor </span> will not throttle customer's queries, instead it will let you monitor the MySQL usage to see the abusers at any given moment of time (and historically). This mode is good when you are just starting and want to see what is going on<br> <span class="notranslate"><strong>single -- Single restricted's LVE for all restricted customers (deprecated)</strong> :  </span> In that mode once customer reaches the limits specified in the <span class="notranslate"> MySQL Governor </span> , all customer's queries will be running inside LVE with id 3. This means that when you have 5 customers restricted at the same time, all queries for all those 5 customers will be sharing same LVE. The larger the number of restricted customers - the less resources per restricted customer will be available<br> <span class="notranslate"><strong>abusers - Use LVE for a user to restrict queries (default mode)</strong> :  </span> In that mode, once user goes over the limits specified in the <span class="notranslate"> MySQL Governor </span> , all customer's queries will execute inside that user's LVE. We believe this mode will help with the condition when the site is still fast, but MySQL is slow (restricted) for that user. If someone abuses MySQL, it will cause queries to share LVE with PHP processes, and PHP processes will also be throttled, causing less of a new queries being sent to MySQL. <em>Requires</em> <span class="notranslate"><em>dbuser-map</em></span> <em>file</em><br> <span class="notranslate"><strong>all - Always run queries inside user's LVE</strong> :  </span> This way there are no need for separate limits for MySQL. Depending on overhead we see in the future, we might decide to use it as a primary way of operating <span class="notranslate"> MySQL Governor </span> . The benefits of this approach is that limits are applied to both PHP &amp; MySQL at the same time, all the time, preventing any spikes what so ever. <em>Requires</em> <span class="notranslate"><em>dbuser-map</em></span> <em>file</em></p> <p>If <span class="notranslate"> dbuser-map </span> file is absent on the server, &quot; <span class="notranslate"> abusers </span> &quot; mode emulates &quot; <span class="notranslate"> single </span> &quot;.</p> <p>With <span class="notranslate"><strong>single</strong></span> and <span class="notranslate"><strong>abusers</strong></span> mode, once user is restricted, the queries for that user will be limited as long as user is using more than limits specified. After a minute that user is using less, we will unrestricted that user.</p> <p>You can specify modes of operation using <span class="notranslate"><a href="/mysql_governor/#dbctl">dbctl</a></span> or by changing <a href="/mysql_governor/#configuration">configuration file</a> .
<span class="notranslate"> dbuser-map </span> file is located in <span class="notranslate"> /etc/container/dbuser-map </span></p> <h2 id="configuration"><a href="#configuration" aria-hidden="true" class="header-anchor">#</a> Configuration</h2> <p><span class="notranslate"> MySQL Governor </span> configuration is located in <span class="notranslate"> /etc/container/mysql-governor.xml </span></p> <p>It is best to modify it using <span class="notranslate"><a href="/mysql_governor/#dbctl">dbctl</a></span> tool.</p> <p>Once configuration file is updated, please, restart the <span class="notranslate"> MySQL Governor </span> using:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ service db_governor restart
</code></pre></div></div>
Example configuration:
<div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>&lt;governor&gt; 

&lt;!--  'off' - do not throttle anything, monitoring only --&gt;
&lt;!--  'abusers' - when user reaches the limit, put user's queries into LVE for that user --&gt;
&lt;!--  'all' - user's queries always run inside LVE for that user --&gt;
&lt;!--  'single' - single LVE=3 for all abusers. --&gt;
&lt;!-- 'on' - deprecated (old restriction type) --&gt;
&lt;!-- To change resource usage of restricted user in LVE mode use command /usr/sbin/lvectl set 3 --cpu=&lt;new value&gt; --ncpu=&lt;new value&gt; --io=&lt;new value&gt; --save-all-parameters --&gt;
&lt;lve use=&quot;on|single|off|abusers|all&quot;/&gt; 

&lt;!-- connection information --&gt;
&lt;!-- If host, login and password are not present, this information is taken from /etc/my.cnf and ~root/.my.cnf --&gt;
&lt;!-- Use symbol specified in prefix to figure out hosting accounts (mysql username will be split using prefix_separator, and first part will be used as account name). If prefix is not set, or empty -- don’t use prefixes/accounts --&gt; 

&lt;!-- db governor will try to split MySQL user names using prefix separator (if present)and statistics will be aggregated for the prefix (account name) --&gt;
&lt;connector host=&quot;...&quot; login=&quot;...&quot; password=&quot;..&quot; prefix_separator=&quot;_&quot;/&gt; 

&lt;!-- Intervals define historical intervals for burstable limits. In seconds --&gt;
&lt;intervals short=&quot;5&quot; mid=&quot;60&quot; long=&quot;300&quot;/&gt; 

&lt;!-- log all errors/debug info into this log --&gt;
&lt;log file=”/var/log/dbgovernor-error.log” mode=”DEBUG|ERROR”/&gt; 

&lt;!-- s -- seconds, m -- minutes, h -- hours, d -- days --&gt;
&lt;!-- on restart, restrict will disappear --&gt;
&lt;!-- log file will contain information about all restrictions that were take --&gt;
&lt;!-- timeout - penalty period when user not restricted, but if he hit his limit during this period he will be restricted with higher level of restrict (for more long time) --&gt;
&lt;!- level1, level2, level3, level4 - period of restriction user for different level of restriction. During this period all user's requests will be placed into LVE container --&gt;

&lt;!-- if user hits any of the limits during period of time specified in timeout, higher level of restrict will be used to restrict user. If user was already on level4, level4 will be applied again --&gt;
&lt;!-- attribute format set an restrict log format:
SHORT -  restrict info only
MEDIUM - restrict info, _all_tracked_values_
LONG - restrict info, _all_tracked_values_, load average and vmstat info
VERYLONG - restrict info, _all_tracked_values_, load average and vmstat info, slow query info --&gt;
&lt;!-- script -- path to script to be triggered when account is restricted --&gt;
&lt;!-- user_max_connections - The number of simultaneous connections of blocked user (in LVE mode) --&gt; 

&lt;!-- restriction levels/format are deprecated --&gt;
&lt;restrict level1=&quot;60s&quot; level2=&quot;15m&quot; level3=&quot;1h&quot; level4=&quot;1d&quot; timeout=&quot;1h&quot;
log=&quot;/var/log/dbgovernor-restrict.log&quot; format=&quot;SHORT|MEDIUM|LONG|VERYLONG&quot;
script=&quot;/path/to/script&quot;
user_max_connections=&quot;30&quot;/&gt; 

&lt;!-- period (deprecated) - period based restriction that has multiple levels (see above) --&gt;
&lt;!-- limit (by default) - when user hits limits, the account will be marked as restricted and if user does not hit  limit again during &quot;unlimit=1m&quot; account will be unrestricted. This mode doesn't have any additional levels/penalties. --&gt;
&lt;restrict_mode use=&quot;period|limit&quot; unlimit=&quot;1m&quot;/&gt;

&lt;!-- killing slow SELECT queries (no other queries will be killed) --&gt;
&lt;!-- if &quot;log&quot; attribute was set all killed queries will be saved in log file --&gt;
&lt;!-- slow parameter in the &lt;limit name=&quot;slow&quot; current=&quot;30&quot;/&gt; will no be applied without enabling slow_queries --&gt; 
&lt;slow_queries run=&quot;on|off&quot; log=&quot;/var/log/dbgovernor-kill.log&quot;/&gt; 
&lt;!-- Enable or disable saving of statistics for lve-stats - On - enabled, Off-disabled --&gt;
&lt;statistic mode=&quot;on|off&quot;&gt;&lt;/statistic&gt;
&lt;!-- Enable logging user queries on restrict, can be On or Off --&gt;
&lt;!-- Files are saved in /var/lve/dbgovernor-store and being kept here during 10 days --&gt;
&lt;logqueries use=&quot;on|off&quot;&gt;&lt;/logqueries&gt;
&lt;default&gt;
&lt;!-- -1 not use limit(by default, current - required) --&gt;
&lt;limit name=&quot;cpu&quot; current=&quot;150&quot; short=&quot;100&quot; mid=&quot;90&quot; long=&quot;65&quot;/&gt;
&lt;limit name=&quot;read&quot; current=&quot;100000000&quot; short=&quot;90000000&quot; mid=&quot;80000000&quot; long=&quot;70000000&quot;/&gt;
&lt;limit name=&quot;write&quot; current=&quot;100000000&quot; short=&quot;90000000&quot; mid=&quot;80000000&quot; long=&quot;70000000&quot;/&gt;
&lt;!-- Time to kill slow SELECT queries for account, can be different for accounts in seconds(but unit can be specified) --&gt;
&lt;!-- enabled only when slow_queries run=&quot;on&quot; --&gt;
&lt;!-- s -- seconds, m -- minutes, h -- hours, d -- days --&gt;
&lt;limit name=&quot;slow&quot; current=&quot;30&quot;/&gt;
&lt;/default&gt;
&lt;!-- name will matched account name, as extracted via prefix extraction --&gt; 

&lt;!-- mysql_name will match exact MySQL user name. If both name and mysql_name are present, system will produce error --&gt;
&lt;!-- mode restrict -- default mode, enforcing restrictions --&gt;
&lt;!-- mode norestrict -- track usage, but don’t restrict user --&gt; 
&lt;!-- mode ignore -- don’t track and don’t restrict user --&gt;
&lt;user name=”xxx” mysql_name=”xxx” mode=”restrict|norestrict|ignore”&gt;
&lt;limit...&gt;
&lt;/user&gt; 

&lt;!-- debug mode for particular user. The information logged to restrict log. --&gt;
&lt;debug_user name=&quot;xxx&quot;/&gt; 

&lt;/governor&gt;
</code></pre></div></div> <p>These values can also be set using <a href="/command-line_tools/#cloudlinux-config">cloudlinux-config</a> CLI utility</p> <h2 id="starting-and-stopping"><a href="#starting-and-stopping" aria-hidden="true" class="header-anchor">#</a> Starting And Stopping</h2> <p>To start:
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>$ service db_governor start
</code></pre></div></div> <p>To stop:
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>$ service db_governor stop
</code></pre></div></div> <h2 id="mapping-a-user-to-database"><a href="#mapping-a-user-to-database" aria-hidden="true" class="header-anchor">#</a> Mapping a User to Database</h2> <p><strong>[</strong> <span class="notranslate"><strong>MySQL Governor</strong></span> <strong>1.x]</strong></p> <p>Traditionally <span class="notranslate"> MySQL Governor </span> used prefixes to map user to database. With the latest version, we automatically generate <span class="notranslate"> user -&gt; database user </span> mapping for <span class="notranslate"> cPanel </span> and <span class="notranslate"> DirectAdmin </span> control panels (other panels will follow).</p> <p>The mapping file is located in: <span class="notranslate"> /etc/container/dbuser-map </span></p> <p>The format of the file:
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>[dbuser_name1] [account_name1] [UID1]
...
[dbuser_nameN] [account_nameN] [UIDN]
</code></pre></div></div>
For example:
<div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>pupkinas_u2 pupkinas 502
pupkinas_u1 pupkinas 502
pupkinas_u3 pupkinas 502
pupkin2a_uuu1 pupkin2a 505
pupkin10_p10 pupkin10 513
pupkin5a_u1 pupkin5a 508
pupkin3a_qq1 pupkin3a 506
pupkin3a_test22 pupkin3a 506
pupkin3a_12 pupkin3a 506
</code></pre></div></div> <p>This would specify that db users: <span class="notranslate"> pupkinas_us2, pupkinas_u1, pupkinas_u3 </span> belong to user <span class="notranslate"> pupkinas </span> with uid (lve id) 502
db user <span class="notranslate"> pupkin2a_uuu1 </span> belongs to user <span class="notranslate"> pupkin2a </span> with uid 505, etc...</p> <p>This file is checked for modifications every 5 minutes.</p> <p>If you need to force reload of that file, run:
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>service db_governor restart
</code></pre></div></div> <h2 id="log-files"><a href="#log-files" aria-hidden="true" class="header-anchor">#</a> Log Files</h2> <p><span class="notranslate"><strong>Error_log</strong></span></p> <p><span class="notranslate"> MySQL Governor </span> error log is used to track any problems that <span class="notranslate"> MySQL Governor </span> might have</p> <p><span class="notranslate"><strong>Restrict_log</strong></span></p> <p>Restrict log is located in <span class="notranslate"> /var/log/dbgovernor-restrict.log </span></p> <p>Restrictions:
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>_timestamp_ _username_ LIMIT_ENFORCED _limit_setting_ __current_value_                         _restrict_level__ SERVER_LOAD TRACKED_VALUES_DUMP
 ... 
</code></pre></div></div> <ul><li><span class="notranslate"> TRACKED_VALUES_DUMP=busy_time:xx,cpu_time:xx,... </span></li> <li><span class="notranslate"> SERVER_LOAD </span> = load averages followed by output of <span class="notranslate"> vmstat </span></li> <li><span class="notranslate"> TRACKED_VALUES_DUMP </span> is available with <span class="notranslate"> MEDIUM &amp; LONG </span> format</li> <li><span class="notranslate"> SERVER_LOAD </span> is available with <span class="notranslate"> LONG </span> format</li></ul> <h2 id="change-mysql-version"><a href="#change-mysql-version" aria-hidden="true" class="header-anchor">#</a> Change MySQL version</h2> <p>If you would like to change to a different MySQL version, or switch to <span class="notranslate"> MariaDB </span> you have to start by backing up existing databases.</p> <p>::: tip Note
For experienced users only. Changing MySQL version is a quite complicated procedure, it causes system table structural changes which can lead to unexpected results. Think twice before proceeding.
:::</p> <p>::: danger IMPORTANT
Please make full database backup (including system tables) before you will do upgrade of MySQL or switch to MariaDB. This action will prevent data losing in case if something goes wrong.
:::</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ /usr/share/lve/dbgovernor/mysqlgovernor.py --mysql-version=MYSQL_VERSION
$ /usr/share/lve/dbgovernor/mysqlgovernor.py --install
</code></pre></div></div> <ul><li>If you are using <span class="notranslate"> cPanel </span> or <span class="notranslate"> DirectAdmin </span> - recompile <span class="notranslate"> Apache </span> .</li></ul> <p>To install beta version of MySQL:
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>$ /usr/share/lve/dbgovernor/mysqlgovernor.py --install-beta
</code></pre></div></div> <p><span class="notranslate"> MYSQL_VERSION </span> can be one of the following:</p> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><span class="notranslate"> auto </span></td> <td>default version of MySQL for given OS release (or cPanel settings)</td></tr> <tr><td><span class="notranslate"> mysql50   </span></td> <td>MySQL v5.0</td></tr> <tr><td>mysql51</td> <td>MySQL v5.1</td></tr> <tr><td>mysql55</td> <td>MySQL v5.5</td></tr> <tr><td>mysql56</td> <td>MySQL v5.6</td></tr> <tr><td>mysql57</td> <td>MySQL v5.7</td></tr> <tr><td>mysql80</td> <td>MySQL v8.0 [requires MySQL Governor 1.2-37+; database packages are available in Beta only, so, please use <code>--install-beta</code> flag instead of <code>--install</code> ]</td></tr> <tr><td>mariadb55</td> <td>MariaDB v5.5</td></tr> <tr><td>mariadb100</td> <td>MariaDB v10.0</td></tr> <tr><td>mariadb101</td> <td>MariaDB v10.1</td></tr> <tr><td>mariadb102</td> <td>MariaDB v 10.2</td></tr> <tr><td>mariadb103</td> <td>MariaDB v 10.3 [requires <span class="notranslate"> MySQL Governor 1.2-36+; for cPanel - MySQL Governor 1.2-41+ </span> ]</td></tr> <tr><td>percona56</td> <td>Percona v 5.6</td></tr></tbody></table> <ul><li>We don't recommend to downgrade from MySQL v5.6, MariaDB 10.x</li></ul> <p>::: tip Note
Starting from cPanel &amp; WHM version 70, cPanel supports MySQL 5.7: https://blog.cpanel.com/being-a-good-open-source-community-member-why-we-hesitated-on-mysql-5-7/
:::</p> <p>::: tip Note
Starting from cPanel &amp; WHM version 78, cPanel supports MariaDB 10.3: https://documentation.cpanel.net/display/78Docs/MySQL+or+MariaDB+Upgrade
:::</p> <p>::: tip Note
cPanel does not officially support MySQL 8.0, that is why we don’t recommend to use it on cPanel servers. Use on your own risk for <span class="notranslate"> DirectAdmin and Plesk </span> servers, because downgrade can corrupt your databases.
:::</p> <h2 id="command-line-tools"><a href="#command-line-tools" aria-hidden="true" class="header-anchor">#</a> Command-line Tools</h2> <p><span class="notranslate"> dbtop </span> - monitors MySQL usage on per user bases. <a href="/mysql_governor/#dbtop">More info...</a><br> <span class="notranslate"> dbctl </span> - command line tool to manage <span class="notranslate"> DB Governor configuration.  <a href="/mysql_governor/#dbctl">More info...</a></span><br> <span class="notranslate"> lveinfo --dbgov </span> - provides historical information about usage and customer restrictions. <a href="/mysql_governor/#lveinfo-dbgov">More info...</a><br> <span class="notranslate"> dbgovchar </span> - generates charts for MySQL usage. <a href="/mysql_governor/#dbgovchart">More info...</a></p> <h3 id="dbtop"><a href="#dbtop" aria-hidden="true" class="header-anchor">#</a> dbtop</h3> <p>Utility to monitor MySQL usage. Requires <span class="notranslate"> db_governor </span> to be running. It shows usage for the current, mid and long intervals.</p> <p><strong>Options:</strong></p> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><span class="notranslate"> -c </span></td> <td>show one time user list (no interactive mode)</td></tr> <tr><td><span class="notranslate"> -r interval </span></td> <td>refresh interval for interactive mode (in seconds)</td></tr></tbody></table> <p><strong>Control keys</strong></p> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><span class="notranslate"> z </span></td> <td>toggle color mode and two-color mode</td></tr> <tr><td><span class="notranslate"> q </span></td> <td><span class="notranslate"> F10, Ctrl-c </span> - quit program</td></tr> <tr><td><span class="notranslate"> u </span></td> <td>sort table by username</td></tr> <tr><td><span class="notranslate"> c </span></td> <td>sort table by cpu column</td></tr> <tr><td><span class="notranslate"> r </span></td> <td>sort table by read column</td></tr> <tr><td><span class="notranslate"> w </span></td> <td>sort table by write column</td></tr> <tr><td><span class="notranslate"> l </span></td> <td>sort by restriction level</td></tr> <tr><td><span class="notranslate"> t </span></td> <td>sort by time before restrictions will be lifted.</td></tr></tbody></table> <p>Control keys, that sort table, displays into header of table bold and underlined symbol.
Sorted field will be highlighted by *.
<span class="notranslate"> CAUSE </span> field shows current stage, reason for restriction and number of seconds before restriction will be lifted:
Values of column ' <span class="notranslate"> CAUSE </span> ' - cause of restriction or freezing:
Possible stages: - - <span class="notranslate"> OK </span> , 1 - Restriction 1, 2 - Restriction 2, 3 - Restriction 3, 4 -- restriction level 4</p> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><span class="notranslate"> c - current </span></td> <td>(current value of parameter)</td></tr> <tr><td><span class="notranslate"> s - short </span></td> <td>(average value of 5 last values of parameter)</td></tr> <tr><td><span class="notranslate"> m - middle </span></td> <td>(average value of 15 last values of parameter)</td></tr> <tr><td><span class="notranslate"> l - long </span></td> <td>(average value of 30 last values of parameter)</td></tr> <tr><td></td> <td>and parameter which is cause of restriction</td></tr> <tr><td><span class="notranslate"> 1/s:busy_time/12 </span></td> <td>first level restricted account with short average restriction <span class="notranslate"> by busy_time </span> with 12 seconds left before re-enabled.</td></tr></tbody></table> <p><strong>Display fields:</strong></p> <ul><li><span class="notranslate"> cpu </span> - number in %, shows <span class="notranslate"> cpu </span> usage by user
<ul><li><span class="notranslate"> read </span> - number of bytes (kbytes, mbytes, gbytes) which user reads per second</li> <li><span class="notranslate"> write </span> - number of bytes (kbytes, mbytes, gbytes) write user reads per second</li></ul></li></ul> <p>Accounts highlighted in <em>red</em> color means that the account is restricted.<br>
Accounts highlighted in <em>blue</em> color are in cool down period</p> <p>Command line parameters of <span class="notranslate"> dbtop </span> utility:<br> <span class="notranslate"> -r - dbtop </span> refresh period in seconds ( <span class="notranslate"> dbtop -r12 </span> )</p> <h3 id="dbctl"><a href="#dbctl" aria-hidden="true" class="header-anchor">#</a> dbctl</h3> <p>usage: <span class="notranslate"> dbctl command [parameter] [options] </span></p> <p><strong>commands:</strong></p> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><span class="notranslate"> set </span></td> <td>set parameters for a <span class="notranslate"> db_governor </span></td></tr> <tr><td><span class="notranslate"> list </span></td> <td>list users &amp; their limits. It will list all users who had been active since <span class="notranslate"> Governor </span> restart,  as well as those for who explicit limits were set</td></tr> <tr><td><span class="notranslate"> list-restricted </span></td> <td>list restricted customers, with their limits, restriction reason, and time period they will still be restricted</td></tr> <tr><td><span class="notranslate"> ignore </span></td> <td>ignore particular user</td></tr> <tr><td><span class="notranslate"> watch </span></td> <td>start observing particular user again</td></tr> <tr><td><span class="notranslate"> delete </span></td> <td>remove limits for user/use defaults</td></tr> <tr><td><span class="notranslate"> restrict </span></td> <td>restrict user using lowest level (or if <span class="notranslate"> --level </span> specified, using the specified level)</td></tr> <tr><td><span class="notranslate"> unrestrict </span></td> <td>unrestrict username (configuration file remains unchanged)</td></tr> <tr><td><span class="notranslate"> unrestrict-all </span></td> <td>unrestrict all restricted users (configuration file remains unchanged)</td></tr> <tr><td><span class="notranslate"> --help </span></td> <td>show this message</td></tr> <tr><td><span class="notranslate"> --version </span></td> <td>version number</td></tr> <tr><td><span class="notranslate"> --lve-mode </span></td> <td>set <span class="notranslate"> DB Governor </span> mode of operation. Available values: <span class="notranslate"> off/abusers/all/single/on </span></td></tr> <tr><td></td> <td><span class="notranslate"> off </span> - monitor only, don't throttle</td></tr> <tr><td></td> <td><span class="notranslate"> abusers </span> - when user reaches the limit, put user's queries into LVE for that user (experimental)</td></tr> <tr><td></td> <td><span class="notranslate"> all </span> - user's queries always run inside LVE for that user (experimental)</td></tr> <tr><td></td> <td><span class="notranslate"> single </span> - single LVE for all abusers.</td></tr> <tr><td></td> <td><span class="notranslate"> on </span> - same as <span class="notranslate"> single </span> (deprecated)</td></tr></tbody></table> <p><strong>parameters:</strong></p> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><span class="notranslate"> default </span></td> <td>set default parameter</td></tr> <tr><td><span class="notranslate"> usrename </span></td> <td>set parameter for user</td></tr></tbody></table> <p><strong>options:</strong></p> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><span class="notranslate"> --cpu=N </span></td> <td>limit <span class="notranslate"> CPU </span> (pct) usage</td></tr> <tr><td><span class="notranslate"> --read=N </span></td> <td>limit <span class="notranslate"> READ </span> (MB/s) usage</td></tr> <tr><td><span class="notranslate"> --write=N </span></td> <td>limit <span class="notranslate"> WRITE </span> (MB/s) usage</td></tr> <tr><td><span class="notranslate"> --level=N </span></td> <td>level (1,2,3 or 4) specified (deprecated) - this option is available only for period mode:</td></tr></tbody></table> <p><span class="notranslate"> &lt;restrict_mode use=&quot;period&quot;/&gt; </span> (see <a href="/mysql_governor/#configuration">Configuration</a>)</p> <p>The default mode is &quot; <span class="notranslate"> limit </span> &quot; - when a user hits limits, the account will be marked as restricted and if the user does not hit the limit again during &quot; <span class="notranslate"> unlimit=1m </span> &quot; account will be unrestricted. This mode doesn't have any additional levels/penalties.<br> <span class="notranslate"> &lt;restrict_mode use=&quot;limit&quot; unlimit=&quot;1m&quot;/&gt; </span></p> <p>Changing the <span class="notranslate"> &quot;unlimit&quot; </span> can be done only via the configuration file (see <a href="/mysql_governor/#configuration">Configuration</a> ).
<span class="notranslate"> --slow=N: </span> limit time (in seconds) for long running <span class="notranslate"> SELECT </span> queries</p> <p>Options for parameter <span class="notranslate"> list </span> :</p> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><code>--kb</code></td> <td>show limits in Kbytes no pretty print</td></tr> <tr><td><code>--bb</code></td> <td>show limits in bytes no pretty print</td></tr> <tr><td><code>--mb</code></td> <td>show limits in Mbytes no pretty print</td></tr></tbody></table> <p>Examples:
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>$ dbctl set test2 --cpu=150,100,70,50 --read=2048,1500,1000,800
</code></pre></div></div> <p>sets individual limits for <span class="notranslate"> cpu (current, short, middle </span> period) and <span class="notranslate"> read (current, short, middle, long </span> periods) for user <span class="notranslate"> test2 </span></p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>$ dbctl set default --cpu=70,60,50,40
</code></pre></div></div> <p>changes default <span class="notranslate"> cpu </span> limits.</p> <p>All new limits will be applied immediately</p> <p>To unrestrict user:
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>$ dbctl unrestrict username
</code></pre></div></div> <p>To unrestrict all users:
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>$ dbctl unrestrict-all 
</code></pre></div></div> <p>To restrict user:
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>$ dbctl restrict dbgov
</code></pre></div></div> <p>To restrict user to level 2 restriction:
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>$ dbctl restrict dbgov --level=2
</code></pre></div></div> <p>To make <span class="notranslate"> Governor </span> to ignore user:
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>$ dbctl ignore username
</code></pre></div></div> <p>Delete user's limits, and use defaults instead:
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>$ dbctl delete username
</code></pre></div></div> <p>Show limits as bytes:
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>$dbctl list --bb
</code></pre></div></div> <h3 id="lveinfo-dbgov"><a href="#lveinfo-dbgov" aria-hidden="true" class="header-anchor">#</a> lveinfo --dbgov</h3> <p><span class="notranslate"> lveinfo </span> tool is a part of <span class="notranslate"> lve-stats </span> package. It was extended to collect historical information about MySQL usage.</p> <p><span class="notranslate"> $ lveinfo --dbgov --help </span></p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>Displays information about historical Db Governor usage
Usage: lveinfo [OPTIONS] 

-h --help              : this help run report from date and time in YYYY-MM-DD HH:MM format if not present last 10 mscreen
-v, --version          : version number
-f, --from=            : inutes are assumed
-t, --to=              : run report up to date and time in YYYY-MM-DD HH:MM format
      if not present, reports results up to now
	  --period=          : time period
      usage            : specify minutes with m,  h - hours, days with d, and values:
	  : today, yesterday; 5m - last 5 minutes, 4h -- last four hours,
	  : 2d - last 2 days, as well as today
-o, --order-by=        : orders results by one of the following:
      con              : average connections
      cpu              : average CPU usage
      read             : average READ usage
      write            : average WRITE usage
-u, --user=            : mysql username
-l, --limit=           : max number of results to display, 10 by default
-c, --csv              : display output in CSV format
-b, --format           : show only specific fields into output
      available values:
      ts               : timestamp records
      username         : user name
      con              : average connections
      cpu              : average CPU usage
      read             : average READ usage
      write            : average WRITE usage
      lcpu             : CPU limit
      lread            : READ limit
      lwrite           : WRITE limit
	  --show-all         : full output (show all limits); brief output is default 
	  
-o, --order-by=        : orders results by one of the following:
      ts               : timestamp records
      username         : user name
      max_sim_req      : max simultaneous requests
      sum_cpu          : average CPU usage
      sum_write        : average WRITE usage
      sum_read         : average READ usage
      num_of_rest      : number of restricts
      limit_cpu_end    : limit CPU on period end
      limit_read_end   : limit READ on period end
      limit_write_end  : limit WRITE on period end
	  --id=              : LVE id -- will display record only for that LVE id
	  -u, --user=            : Use username instead of LVE id, and show only record for that user
	  -l, --limit=           : max number of results to display, 10 by default
	  -c, --csv              : display output in CSV format
	  -b, --by-usage         : show LVEs with usage (averaged or max) within 90% percent of the limit
      available values:
      sum_cpu          : average CPU usage
      sum_write        : average WRITE usage
      sum_read         : average READ usage
      num_of_rest      : number of restricts
      limit_cpu_end    : limit CPU on period end
      limit_read_end   : limit READ on period end
      limit_write_end  : limit WRITE on period end
	  --show-all         : full output (show all limits); brief output is default 
	  
	  TS                     : timestamp records
	  USER                   : user name
	  CPU                    : average CPU usage
	  READ                   : average READ usage
	  WRITE                  : average WRITE usage
	  CON                    : average connections
	  lCPU                   : CPU limit
	  lREAD                  : READ limit
	  lWRITE                 : WRITE limit
	  RESTRICT               : C-cpu restrict, R- read restrict, W- write restrict
</code></pre></div></div> <p>Example:
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>root@cpanel1 [~/ttttt]# lveinfo --dbgov --user=dbgov --period=1d --limit=10
TS                   USER   CPU     READ    WRITE   CON     lCPU    lREAD   lWRITE   RESTRICT  
2012-12-06 11:14:49  dbgov   9       0.0     0.0     1       90      1000    1000                
2012-12-06 11:13:49  dbgov   9       0.0     0.0     1       90      1000    1000                
2012-12-06 11:12:49  dbgov   9       0.0     0.0     1       90      1000    1000                
2012-12-06 11:11:49  dbgov   9       0.0     0.0     1       90      1000    1000                
2012-12-06 11:10:49  dbgov   9       0.0     0.0     1       90      1000    1000                
2012-12-06 11:09:49  dbgov   90      0.0     0.0     1       90      1000    1000     C          
2012-12-06 11:08:49  dbgov   0       0.0     0.0     0       400     1000    1000                
2012-12-06 11:07:49  dbgov   0       0.0     0.0     0       400     1000    1000                
2012-12-06 11:06:49  dbgov   0       0.0     0.0     0       400     1000    1000   
</code></pre></div></div> <h3 id="dbgovchart"><a href="#dbgovchart" aria-hidden="true" class="header-anchor">#</a> dbgovchart</h3> <p><span class="notranslate"> dbgovchart </span> is analog of <span class="notranslate"> lvechart </span> tool to create charts representing customer's to MySQL usage</p> <p>Usage: <span class="notranslate"><code>/usr/sbin/dbgovchart [OPTIONS]</code></span></p> <p>Acceptable options are:
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>--help      This help screen
--version   Version number
--from=     Run report from date and time in YYYY-MM-DD HH:MM format
            if not present last 10 minutes are assumed
--to=       Run report up to date and time in YYYY-MM-DD HH:MM format
            if not present, reports results up to now
--period=   Time period
            specify minutes with m,  h - hours, days with d, and values:
            today, yesterday
            5m - last 5 minutes, 4h - last four hours, 2d - last 2 days,
            as well as today
--user=     mysql username
--output=   Filename to save chart as, if not present, output will be sent to STDOUT
--show-all  Show all graphs (by default shows graphs for which limits are set)
</code></pre></div></div> <p>Charts examples:
<img src="/images/1111.png" alt=""> <img src="/images/1111_2.png" alt=""></p> <h2 id="backing-up-mysql"><a href="#backing-up-mysql" aria-hidden="true" class="header-anchor">#</a> Backing Up MySQL</h2> <p>On <span class="notranslate"> cPanel </span> server disable MySQL service monitoring before doing the job:
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>$ whmapi1 configureservice service=mysql enabled=1 monitored=0
</code></pre></div></div> <p>Execute as <span class="notranslate"> root </span> :
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>$ mkdir -p ~/mysqlbkp
$ service mysql restart --skip-networking --skip-grant-tables
$ mysql_upgrade
$ mysqldump --all-databases --routines --triggers &gt; ~/mysqlbkp/dbcopy.sql
$ service mysql stop
$ cp -r /var/lib/mysql/mysql ~/mysqlbkp/
$ service mysql start
</code></pre></div></div> <p>On <span class="notranslate"> cPanel </span> server enable monitoring back:
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>$ whmapi1 configureservice service=mysql enabled=1 monitored=1
</code></pre></div></div> <p>::: tip Note
This operation may take some time.
:::</p> <h2 id="abrt-plugin"><a href="#abrt-plugin" aria-hidden="true" class="header-anchor">#</a> abrt plugin</h2> <p>We have created a plugin for <span class="notranslate"> abrt </span> tool to automatically upload core dumps in case <span class="notranslate"> MySQL Governor </span> crashes.</p> <p>To install the plugin:
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>$ yum install cl-abrt-plugin --enablerepo=cloudlinux-updates-testing
</code></pre></div></div> <p>It will monitor crash reports for <span class="notranslate"><code>/usr/sbin/db_governor, /usr/sbin/dbtop and /usr/sbin/dbctl</code></span></p> <p>You can modify <span class="notranslate"><code>/etc/libreport/plugins/dropbox.conf</code></span> to monitor other software as well by adding them to <span class="notranslate"> AppList </span> .
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>AppLists=/usr/sbin/db_governor,/usr/sbin/dbtop,/usr/sbin/dbctl
</code></pre></div></div> <h2 id="troubleshooting"><a href="#troubleshooting" aria-hidden="true" class="header-anchor">#</a> Troubleshooting</h2> <p><strong>MariaDB 5.5 and MariaDB 10.0: How to set LimitNOFILE correctly for systemd.</strong></p> <p><span class="notranslate"> MariaDB 5.5 </span> and <span class="notranslate"> MariaDB 10.0 </span> have only file for managing the service, but the file has <span class="notranslate"> LSB </span> functions, so it is supported by <span class="notranslate"><code>systemd</code></span> .</p> <p>For adding extra limits, do the following:</p> <ol><li>Run:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>mkdir /etc/systemd/system/mariadb.service.d/
</code></pre></div></div> <ol start="2"><li>Run:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>touch /etc/systemd/system/mariadb.service.d/limits.conf
</code></pre></div></div> <ol start="3"><li>Add the following content to the the file <span class="notranslate"><code>/etc/systemd/system/mariadb.service.d/limits.conf</code></span> :</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>[Service] 
LimitNOFILE=99999
</code></pre></div></div> <p><strong>MySQL Governor lost connection to MySQL - “Can't connect to mysql” messages in /var/log/dbgovernor-error.log (Plesk and DirectAdmin)</strong></p> <p>This may be caused by changing root/administrator credentials without updating MySQL <span class="notranslate"> Governor </span> configuration file.</p> <p>When you change root or administrator credentials in <span class="notranslate"> Plesk or DirectAdmin, </span> you also need to update MySQL <span class="notranslate"> Governor </span> configuration file. This could be done with the following command (available since <span class="notranslate"> governor-mysql 1.2-38): </span></p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>/usr/share/lve/dbgovernor/mysqlgovernor.py --update-config-auth
</code></pre></div></div> <p>The command updates credentials in MySQL <span class="notranslate"> Governor </span> configuration file and restarts <span class="notranslate"> db_governor </span> service afterwards.</p> <p>After applying the command MySQL <span class="notranslate"> Governor </span> successfully connects to MySQL.</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/ybaturin/cloudlinux-doc/edit/dev/docs/mysql_governor/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="back-to-top" data-v-5366e0dd><a href="/mysql_governor/#app" class="nav-arrow top back-to-top__link" data-v-5366e0dd></a></div> </div> <div class="footer" data-v-58ab2eba><div data-v-58ab2eba><a href="https://cloudlinux.com" data-v-58ab2eba><img src="/assets/img/we-are-cloudlinux.783ed390.svg" alt="We are Cloudlinux" data-v-58ab2eba></a></div> <div class="footer-company-title" data-v-58ab2eba>2019. CloudLinux Inc</div> <div data-v-58ab2eba><div data-v-58ab2eba><a href="https://cloudlinux.zendesk.com/hc/sections/115001344329-How-do-I" target="_blank" data-v-58ab2eba>How to</a></div><div data-v-58ab2eba><a href="https://www.cloudlinux.com/getting-started-with-cloudlinux-os" target="_blank" data-v-58ab2eba>Getting started</a></div><div data-v-58ab2eba><a href="https://cloudlinux.zendesk.com/hc/en-us/requests/new" target="_blank" data-v-58ab2eba>Contact support</a></div><div data-v-58ab2eba><a href="https://www.cloudlinux.com/blog" target="_blank" data-v-58ab2eba>Blog</a></div></div> <div class="social" data-v-58ab2eba><span class="footer-social-text" data-v-58ab2eba>Stay in touch</span> <a href="https://www.facebook.com/cloudlinux/" target="_blank" data-v-58ab2eba><img src="/fb.png" class="footer-social-logo" data-v-58ab2eba></a><a href="https://twitter.com/cloudlinuxos/" target="_blank" data-v-58ab2eba><img src="/tw.png" class="footer-social-logo" data-v-58ab2eba></a><a href="https://linkedin.com/company/cloudlinux" target="_blank" data-v-58ab2eba><img src="/in.png" class="footer-social-logo" data-v-58ab2eba></a><a href="https://www.youtube.com/channel/UCZ3YMHWnMP7TaxlXVay5-aw" target="_blank" data-v-58ab2eba><img src="/ytube.png" class="footer-social-logo" data-v-58ab2eba></a></div></div> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c9f6c3cd.js" defer></script><script src="/assets/js/29.85d24611.js" defer></script>
  </body>
</html>
